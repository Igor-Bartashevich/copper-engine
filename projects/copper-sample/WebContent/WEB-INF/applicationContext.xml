<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jaxws="http://cxf.apache.org/jaxws"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd">

	<import resource="classpath:META-INF/cxf/cxf.xml" />
	<import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
	<import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

	<!-- COPPER based implementation of the Orchestration Service -->
	<bean id="copper.OrchestrationService" class="de.scoopgmbh.copper.sample.simplews.orchestration.server.OrchestrationServiceImpl">
		<property name="transientEngine" ref="transientEngine"/>
		<property name="persistentEngine" ref="persistentEngine"/>
	</bean>
	
	<!-- simple implementation of the Orchestration Service, without using COPPER -->
	<bean id="nocopper.OrchestrationService" class="de.scoopgmbh.copper.sample.simplews.nocopper.OrchestrationServiceImpl">
		<property name="customerService" ref="customerService"/>
	</bean>
	
	
	<jaxws:endpoint id="OrchestrationServiceEndpoint" address="/OrchestrationServicePort">
		<jaxws:implementor> 
			<bean parent="copper.OrchestrationService" /> 
<!-- 			<bean parent="nocopper.OrchestrationService" />  -->
		</jaxws:implementor> 
	</jaxws:endpoint>
	
	<jaxws:client id="customerService" address="http://localhost:9091/CustomerServicePort" serviceClass="de.scoopgmbh.customerservice.CustomerService">
	</jaxws:client>
	
    <bean id="wfRepository" class="de.scoopgmbh.copper.wfrepo.FileBasedWorkflowRepository" scope="singleton">
    	<property name="sourceDir" value="src/workflow/java"/>
    	<property name="targetDir" value="target/compiled_workflow"/>
    </bean>
    
    <bean id="defaultTicketPool" class="de.scoopgmbh.copper.util.TicketPool" scope="singleton">
    	<constructor-arg type="java.lang.String"><value>DEFAULT</value></constructor-arg>
    	<constructor-arg type="int"><value>20000</value></constructor-arg>
    </bean>
           
	<bean id="ticketPoolManager" class="de.scoopgmbh.copper.common.DefaultTicketPoolManager">
		<property name="ticketPools">
    		<list>
    			<ref bean="defaultTicketPool" />
		    </list>
  		</property>
	</bean>
	
    <bean id="T_ProcessorPool_DEFAULT" class="de.scoopgmbh.copper.tranzient.TransientPriorityProcessorPool" scope="singleton">
    	<constructor-arg type="java.lang.String"><value>P#DEFAULT</value></constructor-arg>
    	<constructor-arg type="int"><value>4</value></constructor-arg>
    </bean>
	
    <bean id="PASS" class="de.scoopgmbh.copper.tranzient.TransientPriorityProcessorPool" scope="singleton">
    	<constructor-arg type="java.lang.String"><value>PASS</value></constructor-arg>
    	<constructor-arg type="int"><value>20</value></constructor-arg>
    </bean>
	
	<bean id="transientPPManager" class="de.scoopgmbh.copper.common.DefaultProcessorPoolManager" scope="singleton">
		<property name="processorPools">
    		<list>
    			<ref bean="T_ProcessorPool_DEFAULT" />
    			<ref bean="PASS" />
		    </list>
  		</property>
	</bean>
	
	<bean id="transientEngine" class="de.scoopgmbh.copper.tranzient.TransientScottyEngine" scope="singleton" init-method="startup">
		<property name="ticketPoolManager" ref="ticketPoolManager"/>
		<property name="poolManager" ref="transientPPManager"/>
		<property name="timeoutManager">
			<bean class="de.scoopgmbh.copper.tranzient.DefaultTimeoutManager"></bean>
		</property>
		<property name="earlyResponseContainer">
			<bean class="de.scoopgmbh.copper.tranzient.EarlyResponseContainer"></bean>
		</property>
		<property name="dependencyInjector">
			<bean class="de.scoopgmbh.copper.spring.SpringDependencyInjector"></bean>
		</property>
		<property name="wfRepository" ref="wfRepository"/>
	</bean>
	
	<bean id="datasource_default" class="com.mchange.v2.c3p0.ComboPooledDataSource">
    	<property name="driverClass" value="oracle.jdbc.OracleDriver"/>
    	<property name="jdbcUrl" value="jdbc:oracle:thin:COPPER2/COPPER2@localhost:1521:orcl11g"/>
    	<property name="maxPoolSize" value="8"/>
    	<property name="minPoolSize" value="1"/>
    	<property name="connectionTesterClassName" value="de.scoopgmbh.copper.db.utility.oracle.c3p0.OracleConnectionTester"/>
    	<property name="connectionCustomizerClassName" value="de.scoopgmbh.copper.db.utility.oracle.c3p0.OracleConnectionCustomizer"/>
    	<property name="idleConnectionTestPeriod" value="15"/>
	</bean>
	
	<bean id="statisticsCollector" class="de.scoopgmbh.copper.monitoring.LoggingStatisticCollector" init-method="start"/>
	
	<bean id="batcher" class="de.scoopgmbh.copper.batcher.impl.BatcherImpl" scope="singleton" init-method="startup">
    	<constructor-arg type="int"><value>3</value></constructor-arg>
    	<property name="statisticsCollector" ref="statisticsCollector"/>
	</bean>
	
	<bean id="persistent.dbStorage" class="de.scoopgmbh.copper.persistent.OracleScottyDBStorage" scope="singleton">
		<property name="batcher" ref="batcher"/>
		<property name="dataSource" ref="datasource_default"/>
		<property name="wfRepository" ref="wfRepository"/>
	</bean>
	           
    <bean id="persistent.ProcessorPool.default" class="de.scoopgmbh.copper.persistent.PersistentPriorityProcessorPool" scope="singleton">
    	<constructor-arg type="java.lang.String"><value>P#DEFAULT</value></constructor-arg>
    	<constructor-arg type="int"><value>4</value></constructor-arg>
    </bean>
           
	<bean id="persistent.PPManager" class="de.scoopgmbh.copper.common.DefaultProcessorPoolManager" scope="singleton">
		<property name="processorPools">
    		<list>
    			<ref bean="persistent.ProcessorPool.default" />
		    </list>
  		</property>
	</bean>
	
	<bean id="persistentEngine" class="de.scoopgmbh.copper.persistent.PersistentScottyEngine" scope="singleton" init-method="startup">
		<property name="idFactory">
			<bean class = "de.scoopgmbh.copper.common.JdkRandomUUIDFactory"></bean>
<!-- 		<bean class = "de.scoopgmbh.copper.common.AtomicLongIdFactory"></bean> -->
		</property>
		<property name="processorPoolManager" ref="persistent.PPManager"/>
		<property name="dependencyInjector">
			<bean class="de.scoopgmbh.copper.spring.SpringDependencyInjector"></bean>
		</property>
		<property name="dbStorage" ref="persistent.dbStorage"/>
		<property name="wfRepository" ref="wfRepository"/>
	</bean>
	
	<bean id="auditTrail" class="de.scoopgmbh.copper.audit.BatchingAuditTrail" scope="singleton">
		<property name="batcher" ref="batcher"/>
		<property name="dataSource" ref="datasource_default"/>
	</bean>	

	<bean id="customerServiceAdapter" class="de.scoopgmbh.copper.sample.simplews.orchestration.server.CustomerServiceAdapter" scope="singleton">
		<property name="customerService" ref="customerService"/>
	</bean>	
	
</beans>
